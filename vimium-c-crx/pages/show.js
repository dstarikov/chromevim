"use strict";function L(n){}function U(){0}function Z(){var n=pn.scrollWidth;yn.style.height=pn.scrollHeight+"px",yn.style.width=n+"px",yn.style.display=""}function K(n,t){var e,i;if(t.preventDefault(),VData.url){for(i in e=document.createElement("a"),n)e.setAttribute(i,n[i]);e.href=VData.url,W(e,t)}}function W(n,t){var e=document.createEvent("MouseEvents");return e.initMouseEvent("click",true,true,window,1,0,0,0,0,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),n.dispatchEvent(e)}function Q(n){var t,e,i=n.keyCode;if(VData.error)return false;if(32===i||13===i)return n.preventDefault(),W(pn,n),true;if(!window.VKeyboard)return false;if(!(t=VKeyboard.an(n)))return false;switch(e=0,VKeyboard.cn(n,t)){case"<c-=>":case"+":case"=":case"<up>":e=1;break;case"<left>":e=-2;break;case"<right>":e=2;break;case"<c--\x3e":case"-":case"<down>":e=-1;break;default:return false}return n.preventDefault(),n.stopImmediatePropagation(),_n&&_n.viewed?X(_n,e):ln().then(sn).then(function(n){X(n,e)}).catch(cn),true}function X(n,t){2===t||-2===t?n.rotate(45*t):n.zoom(t/10,true)}function Y(n){try{n=decodeURIComponent(n)}catch(n){}return n}function nn(n){var t=u("#bodyTemplate"),e=document.importNode(t.content.querySelector("#"+n),true);return document.body.insertBefore(e,t),e}function tn(n){if(n.altKey)return n.stopImmediatePropagation(),K({download:VData.file||""},n);switch(VData.type){case"url":K({target:"_blank"},n);break;case"image":if(VData.error)return;ln().then(sn).catch(cn)}}function en(n){n.preventDefault(),pn.onclick&&pn.onclick(n)}function rn(n,t){u("#textTip").dataset.text=n;var e=u("#textBody");return t?(e.textContent="string"!==typeof t?t.join(" "):t,pn.onclick=on):e.classList.add("null"),Z()}function on(n){n.preventDefault();var t="url"===VData.type?u("#textBody").textContent:VData.url;if(t&&window.VPort)return VPort.ii({H:16,d:t}),VHud.li(t)}function un(n){"image"===VData.type&&(VData.error||_n&&_n.visible?n.preventDefault():pn.classList.toggle("invert"))}function an(n,t){return window[n]?Promise.resolve(window[n]):window[n]=new Promise(function(e,i){var r=document.createElement("script");r.src=t,r.onerror=function(){i("ImportError: "+n)},r.onload=function(){var t=window[n];t?e(t):this.onerror()},document.head.appendChild(r)})}function fn(n){if(!u('link[href="'+n+'"]')){var t=document.createElement("link");t.rel="stylesheet",t.href=n,document.head.insertBefore(t,u('link[href$="show.css"]'))}}function cn(n){n&&console.log("%o",n)}function ln(){return window.Viewer?Promise.resolve(Viewer):(fn("../lib/viewer.min.css"),an("Viewer","../lib/viewer.min.js").then(function(n){return n.setDefaults({navbar:false,shown:function(){yn.style.display="none"},viewed:function(){if(kn)return kn(true)},hide:function(){if(yn.style.display="",kn)return kn(false)}}),n}))}function sn(n){var t,e=getSelection();return"Range"===e.type&&e.collapseToStart(),(t=_n=_n||new n(pn)).visible||t.show(),t.viewed?t:new Promise(function(n,e){kn=function(i){kn=null,i?n(t):e("failed to view the image")}})}function dn(){"image"===VData.type&&(document.body.classList.remove("filled"),pn.removeAttribute("src"),_n&&(_n.destroy(),_n=null))}function wn(n){function t(n){try{return new URL(n)}catch(n){}return null}function e(n){if(!n)return"";try{n=decodeURIComponent(n)}catch(n){}return n}var i,r,o,u,a,f,c,l,s,d,w,h,m,g,v,b,p,y=t(n);if(!y||!/^s?ftp|^http/i.test(y.protocol))return null;if(r=/\.(?:bmp|gif|icon?|jpe?g|png|tiff?|webp)(?=[.\-_]|\b)/i,(i=y.search).length>10)for(o=/^(?:imgurl|mediaurl|objurl|origin(?:al)?|real\w*|src|url)$/i,u=/%(?:3[aA]|2[fF])/,a=0,f=i.substring(1).split("&");a<f.length;a++)if(l=(c=f[a]).split("=",1)[0],(i=c.substring(l.length+1)).length>7&&(i.indexOf("://")<0&&u.test(i)&&(i=e(i).trim()),i.indexOf("/")>0&&null!=t(i))){if(o.test(l))return i;if(s=i.split("?")[0].split("/"),r.test(s[s.length-1])&&l.toLowerCase().indexOf("thumb")<0)return i}if(d=null,(d=/[?&]s=\d{2,4}(&|$)/.exec(i=y.search))&&i.split("=").length<=3)return y.origin+y.pathname;if(w=i=y.pathname,h=i.lastIndexOf("/")+1,v=null,g=(m=(i=i.substring(h)).lastIndexOf("@")+1||i.lastIndexOf("!")+1)>2||null!=r.exec(i)){for(h+=m,i=i.substring(m),b=/(?:[.\-_]|\b)(?:[1-9]\d{2,3}[a-z]{1,3}[_\-]?|[1-9]\d?[a-z][_\-]?|0[a-z][_\-]?|[1-9]\d{1,3}[_\-]|[1-9]\d{1,2}(?=[.\-_]|\b)){2,6}(?=[.\-_]|\b)/gi;v=b.exec(i);d=v);d&&/.[_\-].|\d\dx\d/i.test(d[0])?(v=r.exec(i.substring(d.index+d[0].length)),p=d[0].length,v&&0===v.index&&(p+=v[0].length),i=w.substring((h+=d.index)+p),/[@!]$/.test(i||w.charAt(h-1))?i?i=i.substring(0,i.length-1):h--:i||!v||0!==v.index||r.exec(w.substring(Math.max(0,h-6),h))||(i=v[0])):(d=/\b([\da-f]{8,48})([_-][a-z]{1,2})\.[a-z]{2,4}$/.exec(i))?(h+=d.index+d[1].length,i=i.substring(d.index+d[1].length+d[2].length)):g=false}return g||m>2?g=g||0:(d=/_(0x)?[1-9]\d{2,3}(x0)?\./.exec(i))?i=i.substring(0,d.index)+i.substring(d.index+d[0].length-1):i.startsWith("thumb_")?i=i.substring(6):/^[1-9]\d+$/.test(i)&&+i>0&&+i<640?(h--,i=""):g=0,0!==g?y.origin+w.substring(0,h)+i:null}function hn(n){var t=n.split(":",1)[0];switch(t.toLowerCase()){case"thunder":case"flashget":case"qqdl":n=n.substring(t.length+3).split("&",1)[0];break;default:return""}try{n=atob(n)}catch(n){return""}return n.startsWith("AA")&&n.indexOf("ZZ",n.length-2)>0&&(n=n.substring(2,n.length-2)),n.startsWith("[FLASHGET]")&&n.indexOf("[FLASHGET]",n.length-10)>0&&(n=n.substring(10,n.length-10)),hn(n)||n}function mn(){console.log("Failed to visit the predicted URL, so go back to the original version."),gn(),VData.auto=false,window.onhashchange()}function gn(){var n=false;return"once"===VData.auto&&(VData.auto=false,n=true),n&&vn(),n}function vn(){var n,t,e=VData.type;e&&(n="#!"+e+" "+(VData.file?"download="+encodeURIComponent(VData.file)+"&":"")+(VData.auto?"auto="+("once"===VData.auto?"once":1)+"&":"")+VData.original,window.name=Sn+" "+n,VData.full=n,t=bn(n,Sn,true),history.replaceState(t,"",""))}function bn(n,t,e){var i,r,o,u=[],a=!!("".codePointAt&&String.fromCodePoint);if(e)for(i=0;i<n.length&&(null!=(r=a?n.codePointAt(i):n.charCodeAt(i))&&!isNaN(r));i++)r<=127?u.push(r):r<=2047?u.push(192|r>>6,128|63&r):r<=65535?u.push(224|r>>12,128|r>>6&63,128|63&r):r<=2097151&&u.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else for(i=0;i<n.length&&(null!=(r=n.charCodeAt(i))&&!isNaN(r));i++)u.push(r);for(i=0;i<u.length;i++)u[i]=u[i]^255&t>>>8*(3&i);if(e)return String.fromCharCode.apply(String,u);for(o=[],i=0;i<u.length;)(r=u[i])<=127?(o.push(r),i++):r<193?(o.push((31&r)<<6|63&u[i+1]),i+=2):r<225?(o.push((15&r)<<12|(63&u[i+1])<<6|63&u[i+2]),i+=3):r<241&&(o.push((7&r)<<18|(63&u[i+1])<<12|(63&u[i+2])<<6|63&u[i+3]),i+=4);return(a?String.fromCodePoint:String.fromCharCode).apply(String,o)}var u,o,pn,yn,kn,_n,VData,Sn,xn;u=function(n){return document.querySelector(n)},(o=window.chrome&&chrome.extension&&chrome.extension.getBackgroundPage())&&o.Utils&&o.Utils.Yo||(o=null),pn=null,yn=u("#bgLink"),kn=null,_n=null,VData=null,Sn=window.name&&+window.name.split(" ")[0]||0,xn=0,window.onhashchange=function(){var n,t,e,i,r,u,a,f,c,l;for(pn&&(dn(),yn.style.display="none",pn.remove(),pn=null),VData=Object.create(null),t="",e="",!(n=location.hash)&&o&&o.Settings&&o.Settings.Ya.Qa?(i=bn(n=o.Settings.Ya.Qa(),Sn=Sn||Math.floor(4294967296*Math.random())||3286711320,true),history.state?history.pushState(i,"",""):history.replaceState(i,"",""),window.name=Sn+" "+n):n||!history.state||(Sn?(n=bn(history.state,Sn,false),window.name=Sn+" "+n):history.replaceState(null,"","")),VData.full=n,n.length<3||(n.startsWith("#!image")?(n=n.substring(8),t="image"):n.startsWith("#!url")&&(n=n.substring(6),t="url")),r=void 0;r=n.indexOf("&")+1;)if(n.startsWith("download="))e=(e=Y(n.substring(9,r-1)).split(/\||\uff5c| [-\xb7] /,1)[0].trim()).replace(/[\r\n"]/g,""),VData.file=e,n=n.substring(r);else{if(!n.startsWith("auto="))break;u=n.substring(5,12).split("&",1)[0].toLowerCase(),VData.auto="once"===u?u:"true"===u||"false"!==u&&parseInt(u,10)>0,n=n.substring(r)}switch(n.indexOf(":")<=0&&n.indexOf("/")<0&&(n=Y(n).trim()),n?n.toLowerCase().startsWith("javascript:")?t=n=e=VData.file="":o?(a=o.Utils.Yo(n,null,-2),o.Utils.Ko<=2&&(n=a)):n.startsWith("//")?n="http:"+n:/^([-.\dA-Za-z]+|\[[\dA-Fa-f:]+])(:\d{2,5})?\//.test(n)&&(n="http://"+n):"image"===t&&(t=""),VData.type=t,VData.url=VData.original=n,t){case"image":VData.auto&&(f=wn(n))&&(console.log("Auto predict a better URL of\n %o =>\n %o",n,f),n=VData.url=f),(pn=nn("shownImage")).classList.add("hidden"),pn.onerror=function(){VData.url===VData.original?(gn(),VData.auto=false,this.onerror=this.onload=null,this.alt=VData.error="\xa0(fail in loading)\xa0",o&&o.Settings&&o.ChromeVer>=60&&this.classList.add("broken"),this.classList.remove("hidden"),setTimeout(Z,34),this.onclick=function(n){n.ctrlKey||n.shiftKey||n.altKey||!chrome.tabs||!chrome.tabs.update?K({target:"_top"},n):chrome.tabs.update({url:VData.url})}):mn()},n.indexOf(":")>0||n.lastIndexOf(".")>0?(pn.src=n,pn.onclick=tn,pn.onload=function(){var n=this.naturalWidth;if(n<12&&this.naturalHeight<12){if(VData.auto)return void mn();if(n<2&&this.naturalHeight<2)return console.log("The image is too small to see."),void this.onerror(null)}VData.url!==VData.original&&(VData.original=VData.url),gn(),this.onerror=this.onload=null,setTimeout(function(){pn.src=pn.src},0),Z(),this.classList.remove("hidden"),this.classList.add("zoom-in"),n>=.9*innerWidth&&document.body.classList.add("filled")}):(n=VData.url="",pn.onerror(null),pn.alt=VData.error="\xa0(null)\xa0"),e&&(c=e.split(/\/\\/),pn.setAttribute("download",c[c.length-1]),pn.alt=e,pn.title=e);break;case"url":if(pn=nn("shownText"),n&&o){if(l=null,n.startsWith("vimium://")&&(l=o.Utils.Zo(n.substring(9),1,true)),"string"===typeof(l=null!==l?l:o.Utils.Yo(n,null,-1)))l=o.Utils.oa(l),l=o.Utils.Ma(l);else{if(l instanceof o.Promise){l.then(function(n){rn(n[1],n[0]||n[2]||"")});break}if(l instanceof o.Array){rn(l[1],l[0]);break}}n=l}"string"===typeof n&&(n=hn(n)||n),rn(t,n);break;default:n="",(pn=nn("shownImage")).src="../icons/vimium.png",yn.style.display="none"}yn.dataset.vimUrl=n,e?(yn.dataset.vimText=e,yn.download=e):(yn.removeAttribute("data-vim-text"),yn.removeAttribute("download")),yn.onclick=pn?en:tn,U()},"".startsWith||(String.prototype.startsWith=function(n){return 0===this.lastIndexOf(n,0)}),window.onhashchange(),window.onpopstate=function(){window.onhashchange()},document.addEventListener("keydown",function(n){if(("image"!==VData.type||!Q(n))&&(n.ctrlKey||n.metaKey)&&!n.altKey&&!n.shiftKey&&!n.repeat){var t=String.fromCharCode(n.keyCode);if("S"===t)return K({download:VData.file||""},n);if("C"!==t)return"A"===t?un(n):void 0;""+getSelection()&&on(n)}});